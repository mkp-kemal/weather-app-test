<script setup>
import { watch } from 'vue';

// PROPS FROM PARENT
const props = defineProps({
  visible: {
    type: Boolean,
    required: true,
  },
  map: {
    type: Object,
    required: true,
  },
});

// SET MAP FROM PARENT
watch(
  () => props.visible,
  (newValue) => {
    if (props.map) {
      const map = props.map;

      if (map.loaded()) {
        onMapReady(map, newValue);
      } else {
        map.once('load', () => {
          onMapReady(map, newValue);
        });
      }
    } else {
      console.warn('Map instance is not defined');
    }
  },
  { immediate: true }
);

const layer = {
  id: 'polygon-layer',
  name: 'Polygon',
  visible: true,
  type: 'fill',
  source: {
    type: 'geojson',
    data: {
      type: 'FeatureCollection',
      features: [
        {
          type: 'Feature',
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [
                  109.88378860355624,
                  3.246629411887395
                ],
                [
                  109.719212310038,
                  3.238547311111461
                ],
                [
                  109.55622743122368,
                  3.214379228065633
                ],
                [
                  109.39640967919601,
                  3.1743590430203157
                ],
                [
                  109.24130353764974,
                  3.1188739737579154
                ],
                [
                  109.09240708616309,
                  3.048460733715872
                ],
                [
                  108.95115734055024,
                  2.963800216864409
                ],
                [
                  108.81891626510946,
                  2.865710770949712
                ],
                [
                  108.69695759979707,
                  2.7551401358307612
                ],
                [
                  108.58645463066208,
                  2.6331561370623406
                ],
                [
                  108.4884690159625,
                  2.5009362364668326
                ],
                [
                  108.40394076395252,
                  2.3597560511298896
                ],
                [
                  108.33367944202399,
                  2.210976960079044
                ],
                [
                  108.27835668125617,
                  2.0560329239699167
                ],
                [
                  108.2385000258889,
                  1.8964166475850304
                ],
                [
                  108.21448816404533,
                  1.7336652180596879
                ],
                [
                  108.20654756428559,
                  1.569345353719866
                ],
                [
                  108.21475053220566,
                  1.4050383994735822
                ],
                [
                  108.23901469210284,
                  1.2423252050366815
                ],
                [
                  108.27910389038955,
                  1.082771022046335
                ],
                [
                  108.33463050956496,
                  0.9279105554113207
                ],
                [
                  108.40505917372933,
                  0.7792333030910468
                ],
                [
                  108.48971181844527,
                  0.638169316842116
                ],
                [
                  108.58777408887228,
                  0.5060755142177382
                ],
                [
                  108.69830302027586,
                  0.384222669098167
                ],
                [
                  108.82023594412087,
                  0.2737832040842714
                ],
                [
                  108.95240055102043,
                  0.1758199030040133
                ],
                [
                  109.09352602900118,
                  0.09127565537646518
                ],
                [
                  109.24225518217212,
                  0.02096433679593332
                ],
                [
                  109.39715742139072,
                  -0.03443708026141045
                ],
                [
                  109.55674250542512,
                  -0.07439510177627566
                ],
                [
                  109.71947489899955,
                  -0.09852490287034316
                ],
                [
                  109.88378860355624,
                  -0.10659407709652877
                ],
                [
                  110.04810230811293,
                  -0.09852490287034335
                ],
                [
                  110.21083470168736,
                  -0.07439510177627566
                ],
                [
                  110.37041978572177,
                  -0.03443708026141065
                ],
                [
                  110.52532202494037,
                  0.020964336795932924
                ],
                [
                  110.6740511781113,
                  0.09127565537646498
                ],
                [
                  110.81517665609205,
                  0.17581990300401348
                ],
                [
                  110.94734126299163,
                  0.27378320408427126
                ],
                [
                  111.06927418683662,
                  0.38422266909816655
                ],
                [
                  111.17980311824022,
                  0.5060755142177386
                ],
                [
                  111.27786538866721,
                  0.6381693168421149
                ],
                [
                  111.36251803338315,
                  0.7792333030910458
                ],
                [
                  111.43294669754752,
                  0.9279105554113211
                ],
                [
                  111.48847331672295,
                  1.082771022046335
                ],
                [
                  111.52856251500964,
                  1.2423252050366804
                ],
                [
                  111.55282667490684,
                  1.4050383994735822
                ],
                [
                  111.5610296428269,
                  1.5693453537198654
                ],
                [
                  111.55308904306715,
                  1.733665218059687
                ],
                [
                  111.52907718122358,
                  1.8964166475850304
                ],
                [
                  111.48922052585631,
                  2.056032923969916
                ],
                [
                  111.43389776508849,
                  2.210976960079044
                ],
                [
                  111.36363644315996,
                  2.3597560511298896
                ],
                [
                  111.27910819115,
                  2.5009362364668317
                ],
                [
                  111.1811225764504,
                  2.6331561370623406
                ],
                [
                  111.07061960731541,
                  2.7551401358307612
                ],
                [
                  110.94866094200303,
                  2.8657107709497116
                ],
                [
                  110.81641986656224,
                  2.963800216864409
                ],
                [
                  110.67517012094942,
                  3.0484607337158716
                ],
                [
                  110.52627366946275,
                  3.1188739737579154
                ],
                [
                  110.37116752791648,
                  3.1743590430203157
                ],
                [
                  110.2113497758888,
                  3.2143792280656323
                ],
                [
                  110.04836489707449,
                  3.238547311111461
                ],
                [
                  109.88378860355624,
                  3.246629411887395
                ]
              ]
            ]
          },
          properties: {
            nama: 'Area Luar negeri',
            lineColor: "red",
            fillColor: "purple"
          },
        },
      ],
    },
  }
}

// LOAD MAP WITH LAYER
function onMapReady(map, visible) {
  if (visible) {
    if (!map.getLayer(layer.id)) {
      map.addLayer({
        id: layer.id,
        ...layer,
        paint: {
          'fill-color': layer.source.data.features[0].properties.fillColor,
          'fill-opacity': 0.5,
          'fill-outline-color': layer.source.data.features[0].properties.lineColor,
        },
      });
    }
  } else {
    if (map.getLayer(layer.id)) {
      map.removeLayer(layer.id);
      map.removeSource(layer.id);
    }
  }
}
</script>